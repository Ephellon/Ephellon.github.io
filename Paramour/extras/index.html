<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Paramour - The perfect rendezvous" />

  <title>Paramour Examples</title>
  <link rel="shortcut icon" href="../documentation/images/Paramour.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="canonical" href="https://ephellon.github.com/Paramour" />

  <link rel="stylesheet" type="text/css" href="../index.css" />
  <link rel="stylesheet" type="text/css" href="../documentation/css/docs.css" />
  <link rel="stylesheet" type="text/css" href="../documentation/css/tomorrow-night.css" />
  <link rel="stylesheet" type="text/css" href="https://codemirror.net/lib/codemirror.css" />
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,900,400italic,700italic" />
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Product+Sans:400,900,400italic,700italic" />

  <script src='https://codemirror.net/lib/codemirror.js'></script>
  <script src='https://codemirror.net/addon/mode/simple.js'></script>
  <script src='https://codemirror.net/mode/javascript/javascript.js'></script>
  <script src='../paramour/paramour.js'></script>
  <script src='par.min.js'></script>

  <style>
    .CodeMirror, .CodeMirror-gutter {
      background: #1d1f20;
      color: #666;
    }
    .logo.javascript {
      color: #f7df1e;
    }
    .logo.paramour {
      color: #f42424;
    }
    #console {
      width: 100%;
      height: 50%;
    }
  </style>
</head>
<body>
  <h2 id="title">Loading...</h2>

  <p><i>Below is the <b class="paramour logo">Parmour code (left)</b>, and <b class="javascript logo">JavaScript Code (right)</b></i></p>
  <div class='code'>
    <pre><textarea class="compile-paramour" type="text/paramour" id="input"></textarea></pre>
    <pre><textarea class="compile-javascript" type="text/javascript" id="output"></textarea></pre>
    <div class='minibutton ok' onclick='run($("#output").value)'>run</div>
    <br class='clear' />
  </div>

  <hr>

  <h2>Console</h2>
  <textarea id="console" type="text/javascript"></textarea>

  <script type="text/par" id="script"></script>
  <script>
  var options = {
    lineNumbers: false,
    styleActiveLine: true,
    matchBrackets: true,
    indentUnit: 2,
    tabsize: 2,
    indentWithTabs: false,
    readOnly: true,
    autofocus: false,
    lineSeperator: "\n",
    theme: "tomorrow-night-bright"
  },
  poptions = options, joptions = options, Peditor, Jeditor, console, $ = window.$ = function(e){return window.document.querySelector(e)}, p, j, c;
  poptions.mode = "paramour", poptions.readOnly = false, joptions.mode = "javascript";

  Peditor = CodeMirror.fromTextArea(p = $("#input"), poptions);

  (j = $("#output")).innerText = Paramour(p.innerText, true);
  Jeditor = CodeMirror.fromTextArea(j, joptions);

  (c = $("#console")).innerText = "";
  console = CodeMirror.fromTextArea(c, joptions);

  console["[[Value]]"] = "";

  console.log =
  console.dir =
  console.dirxml =
  console.error =
  console.warn =
  console.info =
  function() {
    for(var x = 0, y; x < arguments.length; x++)
      console.setValue(console["[[Value]]"] += " " + ((y = arguments[x]) !== undefined? y: typeof y).toString());
  };

  console.clear =
  function() {
    console.setValue(console["[[Value]]"] = "Console was cleared");
  };

  console.debug =
  function() {
    for(var x = 0, y; x < arguments.length; x++)
      console.setValue(console["[[Value]]"] += " " + ((y = arguments[x]) !== undefined? y: typeof y).toString());
  }

  console.on("keydown", function(c, e) {
    if(e.which === 13 && e.shiftKey)
      console["[[Value]]"] += "\n";
    else if(e.which === 13)
      run(console["[[Value]]"]), console["[[Value]]"] = "";
    else if(e.which < 32)
      console["[[Value]]"] = console.getValue();
    else if(e.altKey || e.ctrlKey || e.metaKey);
    else
      console["[[Value]]"] += e.shiftKey?
        String.fromCharCode(e.which).toUpperCase():
      String.fromCharCode(e.which).toLowerCase(); 
  });

  function run(value) {
    with(console) {
      try {
        value = eval(value);
      } catch(e) {
        return error(e);
      }
      return log(value);
    }
  }

  (function(exec) {

    if (window === undefined || window === null) return;

    function run(code, embed) {
      return Paramour(code, embed || false);
    }

    function load(url, callback, options, hold) {
      var
      xhr = (window.ActiveXObject)?
        new window.ActiveXObject('Microsoft.XMLHTTP'):
      new window.XMLHttpRequest();

      hold = hold || false;
      options = options || {};
      options.sourceFiles = [url];
      xhr.open('GET', url, true);

      if ('overrideMimeType' in xhr)
        xhr.overrideMimeType('text/plain');

      xhr.onreadystatechange = function() {
        var sts;
        if (xhr.readyState === 4) {
          if ((sts = xhr.status) === 0 || sts === 200) {
            if (!hold)
              run(xhr.responseText);
          } else {
            throw new Error("Unable to load: " + url)
          }
          if(callback)
            return callback(xhr.responseText);
        }
      };
      return xhr.send(null);
    }

    function runScripts() {
      var
      types = ['text/paramour', 'text/par'],
      index = 0,
      scripts = window.document.querySelectorAll('#script'),
      paramours = (function() {
        for (var j = 0, k, r = [], s; j < scripts.length; j++)
          if (k = (s = scripts[j]).type, types.indexOf(k) > -1)
            r.push(s);
        return r;
      })();

      function execute() {
        var input = paramours[index];
        if (input !== undefined && input.constructor === String) {
          run(input);
          index++;
          return execute();
        }
      }

      function fn(script, i) {
        var options, source, compile, input,
            IN = window.document.querySelector("#input"),
            OUT = window.document.querySelector("#output"),
            title = window.document.querySelector("#title");
        options = {
          short: script.type === types[1]
        };

        source = script.src = (location.pathname + "ex/" + ((title.innerHTML = (location.hash + "").slice(1, 255).replace(/_/g, " ")) + ".par"));
        input = script.innerText = "";

        return load(source, function(input) {
          return Peditor.setValue(IN.value = paramours[i] = input), Jeditor.setValue(OUT.value = Paramour(input, true)), execute();
        }, options, true);
      }

      for (var i = 0, j = 0, len = paramours.length; j < len; i = ++j)
        fn(paramours[i], i);

      return execute();
    }

    if (window.addEventListener)
      window.addEventListener('DOMContentLoaded', runScripts, false);
    else
      window.attachEvent('onload', runScripts);

  })(true);

  window.Peditor = Peditor, window.Jeditor = Jeditor;
  window.timeout = window.timeout || 0;

  with(window)
  with(Peditor) {
    on("update", function() {
      clearTimeout(timeout);
      setTimeout(function() {
        Jeditor.setValue(Paramour(getValue(), true));
      }, 500);
    });
  }
  </script>
</body>
</html>
